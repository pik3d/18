<html>
<head><meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<title>pik3d_DOC</title>
<style><!--
body {background:white; color:Black; font-size:14px; line-height:13px;}
a:link, a:visited {color:blue; text-decoration:none;}
b {font-weight:bold; Color:#a300a3; font-family:'Arial'; font-size:12px;}
r {Color:RED;}
g {Color:GREEN;}
n {Color:BLUE;}
f {font-weight:normal; Color:#0047b3; font-family:'Lucida Console'; font-size:11px}
--></style></head><body>
<h5><pre><f>Фреимворк ="framework"= каркас = набор инструментов и заготовок для решения задачи</f>
<a href='#fwk'>перейти  к  ОПИСАНИЮ  ФРЕИМВОРКА  <b>pik3d</b>  v.18.0</a>
________________________________________________________________________________________
<b><a name='s3d'>
 команда: s3d -"Surface-3D" ОТОБРАЖЕНИЕ МАТРИЦ и их ПОСЛЕДОВАТЕЛЬНОСТЕЙ/ СТЭКОВ
</b>
         <a href='#bb'>Старт, Начальные Параметры</a>
         <a href='#st'>Просмотр Стэка            </a>
         <a href='#os'>Карта,  Оси,  Сглаживание </a>
         <a href='#cf'>Конфигурация              </a>
         <a href='#pp'>Стэк,  Подробности,  Линии</a>
         <a href='#ss'>Сечения                   </a>
         <a href='#pal'>Цвета                    </a>
         <a href='#tr'>Трэки  Максимумов         </a>

    <b>Система  координат  и  углы  наблюдения/ освещения :</b>

Представим  матрицу  <b>m[ ]</b>  как  прямоугольник  OXEY.
Ось OX - "Строки" - направление сверху вниз - изменение строк.
Ось OY - "Столбцы/ Колонки" - направление вправо - изменение столбцов.
Направление  вверх  над плоскостью XOY  соответствует  оси OZ.

Рассмотрим элемент матрицы, который стоит в i-строке, j-столбце и имеет значение <b>m[i,j]</b>.

          Z
          |
          |  <b>3D - координаты:  x=i,  y=j,  z=m[i,j]</b>
          |
          |    <b>m[i,j]</b>
          |    |
         O|____|___j_____Y
         /     |   /    /
        /      |  /    /
       /       | /    /
     i/________|/    /
     /              /
    /______________/
   X               E

Элемент матрицы  можно отобразить  как  точку  в  3D-пространстве:  X - строка  матрицы,
Y - столбец матрицы, Z - значение.  Совокупность  таких точек  образует  3D-поверхность.

<b>Точка  наблюдения</b>  задаётся двумя углами( "Астрономическая экваториальная система" ):
 -"часовой угол"- в плоскости матрицы от оси-OX вправо к оси-OY в интервале [-180,+180];
 -"склонение"   - угол над плоскостью матрицы: [-90,90].
Углы наблюдения можно менять <b>"Мышью"  при  нажатой  кнопке</b> и в контекстном меню.

<b>Положение  источника  света</b> задаётся также.
Углы освещения можно менять  клавиатурой: <b>&lt;Ctrl> + &lt;стрелки></b> и в контекстном меню.

Углы измеряются в градусах и выводятся в заголовок окна:   <b>v( a, b ),  *( c, d )</b>
где:
     <b>v</b> -"view"  -"вид"  - <b>углы  наблюдения</b>: a -"часовой", b -"склонение"
     <b>*</b> -"Light" -"свет" - <b> углы    освещения</b>: c -"часовой", d -"склонение"

Все углы сохраняются в конфиг. параметрах и могут быть заданы при старте.

Углы  освещения  сильно влияют  на вид  3D-сцены,  когда  они близки к углам наблюдения.
Удобно   сначала  подобрать  ракурс,  а затем  вывести  углы  света  к углам наблюдения
для  тонкой  настройки.

<a name='bb'/>
    <b>Старт,  Начальные Параметры</b>

> s3d  [ Stk  [ config | _ [ main  [ delaySec ]]]]

> s3d                              - выводится запрос на выбор стэка ;
> s3d    Stk                       - отображение стэка: Stk ;
> s3d    Stk    config             - отображение стэка: Stk в заданным  config 3D-сцены,
                                     по умолчанию  конфиг.файлы  имеют расширение: .s3d,
                                     если config не указан - конфигурация  по умолчанию;
> s3d    Stk    config       main  - можно запустить несколько окон <r>s3d</r>, все последующие
                                     за <r>main</r> окна  будут синхронизованы с ним,  т.е.
                                     показывать кадр с тем же номером, что и  <r>main</r> .
> s3d    Stk             _   main  - конфигурация по умолчанию  для  main .
> s3d    Stk    config       main    <r>delaySec</r>  - запуск с  задержанным  стартом,  т.е.
         воспроизведение  начнётся  через  <r>delaySec</r>  секунд  после  старта  s3d  main.
Пример:
         нескольких окон с синхронизацией, удобно оформить как <r>.bat</r>  или <r>.cmd</r>  файл :
<f>
  rem  текст  после  знака  '!' - коментарий,  его нужно убрать из файла
  s3d  q      1   main   3   ! стэк q    , конфиг=1.s3d, "главный" с задержкой 3 сек.
  s3d  qAR2   2              ! стэк qAR2 , конфиг=2.s3d
  s3d  qmd    3              ! стэк qmd  , конфиг=3.s3d
  s3d  qmd15  4              ! стэк qmd15, конфиг=4.s3d
</f>
Сокращения и обозначения:
<Клавиша> - нажатие клавиши на клавиатуре;
<r>^К = &lt;Ctrl + Клавиша></r> - Одновременное  нажатие &lt;Ctrl> и <Клавиши>;
<r>menu> - КОНТЕКСТНОЕ МЕНЮ</r>  вызывается в любом месте окна s3d нажатием <r>ПРАВОЙ КНОПКИ МЫШИ</r>.
        Почти все команды  КОНТЕКСТНОГО МЕНЮ  можно выполнить  комбинацией клавиш.

<a name='st'/>
    <b>menu>  Просмотр Стэка</b>

<r>&lt;Left> / &lt;Right></r> -  предыдущий / следующий  кадр ;
<r>&lt;Home> / &lt;End></r>   - "Начало(1-й)"/ "Конец(последний)" кадр стэка ;
<r>&lt;Колесо_Мыши></r>    - "Листание" кадров :  "ВНИЗ"- вперёд,  "ВВЕРХ"- назад ;

<r>&lt;Пробел></r> - Старт/ Стоп "Клипа"- последовательного отображения кадров стэка;
<r>^K</r>     - задание скорости воспроизведения "Клипа"( к-во.кадров в секунду <= 30 );
<r>&lt;F2></r>   - сохранить "Клип" в многостраничном .tif-файле( запрашивает имя файла );
         Просмотр клипа - <a href='#tif'>команда фреимворка: tif </a>.

<r>&lt;Drag> -"Тащить"</r> - Движение мыши  при  нажатой кнопке - поворот 3D-сцены
                   ( в заголовке окна углы: a-"альфа" и b-"бета" ):
         право/ лево - поворот вокруг ВЕРТИКАЛЬНОЙ   оси - альфа, конфиг.парам.: a[gra]
         вверх/ вниз - поворот вокруг ГОРИЗОНТАЛЬНОЙ оси - бета , конфиг.парам.: b[gra]
<r>^+ / ^-</r>   - увеличить / уменьшить  ИЗОБРАЖЕНИЕ 3D-сцены  на ~10%, конфиг.парам.: K  ;
<r>&lt;Shift + H/L></r> - увеличить / уменьшить  ВЕРТИКАЛЬНЫЙ размер 3D-сцены, конфиг.парам.: Kh ;
<r>&lt;Shift + Left| Right| Up| Dn ></r> - сдвиг 3D-сцены в окне,  конфиг.парам.:  sx, sy.

<a name='os'/>
    <b>menu>  Карта,  Оси,  Сглаживание</b>

<r>^D -"Дно"</r> -Опустить/Поднять "Карту".Стандартное положение "Карты" на уровне минимального
           значения. Эта команда опускает карту на половину вертикальной оси.

<r>^M -"Только Карта"</r> - при включении  вид СВЕРХУ  на матрицу/ кадр,  т.е. стандартный вид
           матрицы:  строки вниз, столбцы вправо.

<r>^Клик_Мыши</r>-"Считать Значение" под курсором  и  Записать его  в  редактируемое  окно.
           Курсор должен указывать на "Карту"( режим: "Только Карта" необязателен ).
           Запись включает:  <r>Номер Кадра:  [ строка, колонка ] = значение</r>.  Окно  предо-
           ставляет  стандартные средства  редактирования.  Для сохранения,  текст нужно
           выделить,  скопировать(^C)  и  вставить(^V)  в  каком-нибудь  редакторе  для
           последующего сохранения в файл. Эту возможность  можно использовать для рисо-
           вания <a href="#lin"> линий </a> на  "Карте".

<r>^A -"Axis"</r>- Включить/ Выключить отображение ОСЕЙ.

<r>^O -"Ось Z: min/MAX"</r> - вызов диалога  задания параметров  вертикальной ОСИ Z.
     Если поднят флажок "Автоматический Выбор", то  min/MAX  берётся  из исходных данных
     загруженного стэка. Сбросить флажок можно непосредственно или <r>&lt;Tab></r>( передаёт фокус
     ввода следующему компоненту ).  Движки  можно  двигать  Мышью  или  клавиатурой:
     <r>&lt;Left>,&lt;Right>, &lt;Home>,&lt;End></r>.  Также значение  можно  ввести  в  поле  ввода,
     предварительно активировав поле ввода Мышью  или <r>&lt;Tab></r>. Завершение ввода - <r>&lt;Enter></r>.
     При  изменении  значения( движком  или  в поле ввода )  Кадр  перестраивается.
     Это  даёт  возможность  тонко  подобрать  min/MAX  и  окраску  поверхности,  т.к.
     к  min  и  MAX  привязывается  диапазон  <a href='#pal'>цветовой  "Палитры"</a>.
     В конце диалога  требуется нажать  кнопку: <r>Сохранить</r>.  Если же нажата  <r>&lt;Esc></r>  или
     кнопка: <r>Отмена</r>,  то  установки  и  Кадр  возвращаются  в  исходное состояние.

<r>^B - Сглаживание("Gaussian Blur")</r> - вызов диалога  ИНТЕРАКТИВНОГО  СГЛАЖИВАНИЯ.
     Параметром является  <r>"РАДИУС колокола Гаусса" = 2*Sigma</r> - это визуальный размер  и
     характерный размер сгаживания( фрагменты > РАДИУСА остаются после фильтрации ).
     РАДИУС СГЛАЖИВАНИЯ < 0.5 не имеет смысла, поэтому  <r>логарифмическая шкала</r> начинается
     с 0.5, причём,при <r>R=.5 сглаживание ВЫКЛЮЧЕНО</r>. Движок можно двигать Мышью или клав.:
     <r>&lt;Left>,&lt;Right>, &lt;Home>,&lt;End></r>.  Также значение можно ввести  в поле ввода + <r>&lt;Enter></r>.
     При изменении значения(движком или в поле ввода после<r>&lt;Enter></r>) Кадр перестраивается.
     Тонкую настройку  можно производить,  держа нажатой клавишу:  <r>&lt;Left></r>  или  <r>&lt;Right></r>.
     В конце диалога  требуется нажать  кнопку: <r>Сохранить</r>.  Если же нажата  <r>&lt;Esc></r>  или
     кнопка: <r>Отмена</r>,  то  установки  и  Кадр  возвращаются  в  исходное состояние.

           <r>ВО ВРЕМЯ ДИАЛОГОВ: ^O и ^B  МОЖНО МЕНЯТЬ РАКУРС КАДРА, ^A, ^D, ^M</r>

Пример содержит полезные приёмы работы с <r>^O и ^B</r>:

> s3d q           ! стэк q из папки: demo,  прокрутить колесом 7-15 кадров
                  ! далее последовательность кнопок :
  <r>^B</r> &lt;Tab> 4 &lt;Enter> &lt;Enter>
  <r>^O</r> &lt;Tab> &lt;Tab> 331 &lt;Tab> &lt;Tab> 328 &lt;Enter> &lt;Enter>

  <r>^B</r> перетащить окно диалога вниз под s3d
     &lt;Right> нажать и держать до остановки картинки
     &lt;Left>  нажать и держать до остановки картинки

<a name='cf'/>
    <b>menu>  Конфигурация</b>

Все параметры: положение окон, размеры, углы, цвета, включённые функции ...  хранятся  в
структуре "КОНФИГУРАЦИЯ". В процессе работы с s3d пользователь выставляет эти параметры,
чтобы получить требуемое отображение.  Удачную конфигурацию  можно  временно сохранить в
памяти <r>^S</r> и позже восстановить - <r>^R</r>. Восстанавливается сохранённая конфигурация  или та,
что  была  на  момент загрузки  стэка.

Просмотр, редактирование  и  сохранение в файле  возможно  после команды:  <r>^С</r> -"Config".
Выводится редактируемое текстовое окно  со значениями параметров, которые  отличаются от
значений по умолчанию.  Окно  можно  закрыть  без  сохранения  изменений:  <r>&lt;Esc></r>.
При редактировании можно изменить, убрать  или  добавить  любые  допустимые  парамметры.
После редактирования конфигурацию можно сразу  установить  или  сохранить  в  Файле.
Если  какой-то параметр  убирается из конфиг.окна, то при установке/ загрузке он получит
значение по умолчанию. Например: надоело периодическое сообщение(конфиг.параметр: msg:),
для отключения открыть Конфиг: ^C  и удалить  или закомментировать( ! или # ) это парам.
После чего,  установить  изменённый  Конфиг.

Новую конфигурацию  можно :
   кнопка:  <r>Установить</r>        - сразу установить ;
   кнопка:  <r>Сохранить в Файле</r> - сохранить для последующей загрузки.

Загрузить конфигурацию можно 2 способами:
 - <r>на старте s3d</r>  после  имени стэка  указать  имя конфиг.файла;
 - <r>^L</r> - загрузка  конфиг.файла  во время  работы.

Список конфиг.параметров [значение по умолчанию]:

  max: [из стэка]  - максимальное значение верт. оси ;
  min: [из стэка]  - минимальное  значение верт. оси ;

  x:       [ 612]  - координата x левого верхненго угла окна s3d ;
  y:       [ 222]  - координата y левого верхненго угла окна s3d ;
  w:       [ 640]  - ширина окна;
  h:       [ 520]  - высотаа окна;
  sx:      [  0 ]  - горизонтальный сдвиг сцены в окне - &lt;Shift + Left/Right> ;
  sy:      [  0 ]  - вертикальный   сдвиг сцены в окне - &lt;Shift + Up/Dn> ;

  K:       [  1 ]  - увеличение окна             - ^+ / ^- ;
  Kh:      [  1 ]  - увеличение вертикальной оси - ^Up / ^Dn ;

  a[gra]:  [ 20 ]  - поворот  сцены  вокруг вертикальной   оси("часовой" угол );
  b[gra]:  [ 25 ]  - поворот  сцены  вокруг горизонтальной оси("склонение"    );
  
  aLight:  [-60 ]  - "часовой" угол поворота света( вокруг вертикальной оси );
  bLight:  [ 30 ]  - "склонение" света ( поворот  вокруг горизонтальной оси );
  
  blur:    [  0 ]  - размытие         - ^B ;
  Ksec:    [ 10 ]  - кадров в секунду - ^K ;

  Dn:      [  0 ]  - режим "Дно Опущено"  - ^D ;
  Axis:    [  1 ]  - показ осей           - ^A ;
  Map:     [  0 ]  - зежим "Только Карта" - ^M ;
  Xxx:     [  0 ]  - показ траектории максимумов         - ^X ;

  Usigm:   [  3 ]  - количество сигм для шума            - ^U ;
  Nint:    [ 200]  - количество интервалов в гистограмме - ^H ;

  Fon:     R G B   - цвет фона окна: [ 242 242 242 ] ,   - ^9 ;
  Text: h  R G B a - "Подробности": размер, цвет, непрозрачность:
                     [14  99 99 99  1], <r>задаётся только в конфиг.файле</r>;

  Pal:     [null]  - файл "Палитры"      - ^P ;
  Data:    [null]  - файл "Подробностей" - ^8 ;
  Line:    [null]  - файл "Линий" ;

  St[]:    [null]  - список стэков, <r>задаётся только в конфиг.файле</r> ;

  msg: t1 dt "text"- начиная с t1-секунды,  с интервалом dt секунд, выводится сообщение,
                     <r>задаётся только в конфиг. файле</r>,  по умолчанию ОТСУТСТВУЕТ.

<a name='pp'/>
    <b>menu>   Стэк,  Подробности,  Линии</b>

<r>^F</r> - загрузить Стэк. Вызывает диалог выбора файла. Текущая конфигурация сохраняется,
     как если бы была нажата <r>^S</r>.

<r>^7</r> - загрузить  <r>"ПОДРОБНОСТИ"</r>.  Вызывает диалог выбора файла.  Строки этого текстового
     файла  будут  выводится  в  правом  верхнем углу  окна  s3d  после  номера кадра.
     Номер строки  соответствует  номеру кадра( пример: demo\data.dat ).

         <r>Во внимание принимаются  ВСЕ СТРОКИ  кроме:  КОМЕТАРИЕВ  и  ПУСТЫХ СТРОК<r>
<a name="lin"/>
<r>^2</r> - загрузить  <r>ЛИНИИ</r>.  Вызывает диалог выбора файла( расширение файлов: <r>.lin</r> ).
     Текстовый файл  содержит  описания  2D  и  3D-линий.
     2D-линия задаётся координатами точек, которые лежат на "карте".  Допускаются  точки
     вне "карты",но отображатся будут только фрагменты линий, которые попали на "карту".
     Точки 3D-линий содержит 3 координаты( X,Y, Z-по вертикали ). Отображаются фрагменты
     линий, у которых: min <= Z <= MAX .

     Координаты линии задаются в <a href='#dat'>### формате</a>. Количество строк = количеству точек линии,
     к-во. столбцов = 2( X,Y ) или 3( X,Y,Z ), т.е. одна строка задаёт одну точку линии.
     К-во. точек 3D-линии может быть равно 1. В этом случае будет отображаться шар.

        <r>Допускается только ТЕКСТОВЫЙ ### формат. Координаты точек НЕобязательно целые</r>

     Заголовок содержит <r>2 дополнительных параметра</r>:
        <r>c=RRGGBB  ! "color"</r> - цвет в  16-ричном  формате, по умолчанию c=0 - ЧЁРНЫЙ;
        <r>w=N_pix   ! "width"</r> - ширина( 3D:толщина ) линии в пикселях, по умолчанию  w=1.
Пример:<f>
! подходит для стэка: demo\q
  ### Буква_П_3d[ 4, 3 ] w=<r>17.5</r> c=99ffcc
    40 100 180
    40 20  500
    20 20  500
    20 100 180

  ### Шар[ <r>1,</r> 3 ] C=ff9999  W=60
    27 57 430

  ### Прямоугольник[ 5, 2 ]  ! <r>по Умолч. w=1 c=0</r>
    50   90
    50  107
    12  107
    12   90
    50   90
</f>
<r>^3 - Включить/ Выключить отображение ЛИНИЙ( 2D и 3D )</r>.
     Если ЛИНИИ включены, то они отображаются на ВСЕХ КАДРАХ.

С помощью 2D-линий можно сделать дополнительную разметку "карты", например:
фиксированные траектории,  координатные сетки,  задание границ,  выделение зон  ...
3D-линии позволяют отображать:  3D-маркеры(например шары),  3D-траектории, границы ...
Примеры ЛИНИЙ можно посмотреть в папке: <r>demo</r>, стандартное расширение файлов: <r>.lin</r>

Для быстрого переключения от стэка к стэку( в рамках ограниченного списка )  s3d  имеет
механизм  задания списка  и  загрузку следующего( или первого )  из  списка  стэка.
Список задаётся в конфиг. файле параметром <r>St[]:</r>,  за которым  следуют  строки  с
описанием стэков:  <r>файл СТЭКА,  файл ПОДРОБНОСТЕЙ,  файл ЛИНИЙ</r>.  Строка связывает  стэк
с соответствующими  подробностями  и  разметкой.  Имена файлов  <r>разделяются запятыми</r>.
Пример:<f>
  <r>St[]:</r>
       q
       c:\demo\g2<r>, ,</r> c:\demo\222.lin
       g3, data.dat
       g4, data.dat, lin1.lin
       c:\demo\ge01<r>,,</r> c:\demo\222.lin
       gg<r>,,</r>333.lin
</f>
<r>menu> Создать Список Стэков</r> - помогает создать список стэков( без ПОДРОБНОСТЕЙ и ЛИНИЙ).
Для входа в режим МУЛЬТИ-выбора надо нажать <r>&lt;Ctrl></r>.  Список записывается в КОНФИГУРАЦИЮ.
Обычно требуется  дополнительное  редактирование/ добавление  параметров.

<r>^N</r> - перейти к  <r>СЛЕДУЮЩЕМУ  из  Списка</r>  стэку( если он последний, то к 1-му );
<r>^1</r> - перейти к  <r>ПЕРВОМУ     из  Списка</r>  стэку .

<a name='ss'/>
    <b>menu>  Сечения </b>

Имеется  ввиду  <a href='#gra'>2D-графики</a>  заданной  строки  или  колонки( столбца ).
Для включения режима требуется:  навести курсор на какую-либо точку "Карты"  и  нажать:
<r>^V - "Values"</r> - на "Карте" появятся 6 линий и 2 окна с графиками сечений ;
                Повторное нажатие <r>^V</r> выключает Сечения. Отображаются текущая строка и
                колонка-ЧЁРНЫЙ цв.,<n>предыдущая через один-СИНИЙ</n>, <r>след.через один-КРАСНЫЙ</r>.

Перемещение Сечений - <r>&lt;Alt + стрелка></r> :
<r>&lt;Alt + Right></r> - передвинуть Сечения на 1 колонку  <r>ВПРАВО</r> - следущая   колонка ;
<r>&lt;Alt + Left></r>  - передвинуть Сечения на 1 колонку  <r>ВЛЕВО</r>  - предыдущая колонка ;
<r>&lt;Alt + Dn></r>    - передвинуть Сечения на 1 строку   <r>ВНИЗ</r>   - следущая   строка  ;
<r>&lt;Alt + Up></r>    - передвинуть Сечения на 1 строку   <r>ВВЕРХ</r>  - предыдущая строка  .

<a name='pal'/>
    <b>menu>  Цвета</b>

<r>^P -Загрузить "Палитру"</r> - вызов диалога выбора файла( расширение по умолчанию: <r>.pal</r> ).
    Палитра -цвета, в которые окрашиваются точки поверхности, в зависимости от значения.
    Задаётся файлом в <a href='#dat'>### формате</a> и состоит из строк, которые связывают значение и цвет.
    Минимуму соответствует 0, максимуму - 1.  Между ними  может быть сколько угодно
    дополнительных значений.  Цвет точки вычисляется, как  линейная интерполяция  между
    соседними табличными значениями.
    Точки  ниже минимума  имеют цвет минимума ( соответствует 0 ).
    Точки  выше максимума имеют цвет максимума( соответствует 1 ).

Цвет может быть задан 2 способами:
  - <r>Red</r>  <g>Green</g>  <n>Blue</n>  ! три числа:  0 <= <r>R</r>, <g>G</g>, <n>B</n> <=255;
  - <r>RR</r><g>GG</g><n>BB</n>            ! 16-ричное представление цвета .

Пример:  стандартная палитра ( определения эквивалентны ):
<f>
  ### Stand.Palet [ 6, <r>4</r> ]  !   ### Stand.Pal16 [ 6, <r>2</r> ]
  !Value   R     G     B    !   !Value  RRGGBB
    0     255   255   255   !     0     ffffff
    .2    166   255    77   !     .2    a6ff4d
    .35     0   255   255   !     .35   00ffff
    .57    79   134   236   !     .57   4f86ec
    .8    255     0     0   !     .8    ff0000
    1     255   217   102   !     1     ffd966
</f>
Пользователь может создать любое количество палитр  для  разных случаев.
Для получения RGB-цветов можно использовать диалог: <r>"Цвет Фона"/ Custom Color.../ RGB</r> .

<r>^0 = &lt;Ctrl + Ноль > - Загрузить "СТАНДАРТНУЮ Палитру"</r>

<r>^9 - "Цвет Фона"></r> - вызывает диалог  выбора цвета Фона  3D-сцены.
     Для него "Opacity" - НЕпрозрачность всегда  = 100 %.
     Цвет Фона можно связать с определённым типом стэка. По умолчанию: [ <r>242</r> <g>242</g> <n>242</n> ].

<r>^8 - "Цвет Подробностей"></r> - вызывает диалог выбора:  кегля,  цвета,  НЕпрозрачности.
     "Opacity" - НЕпрозрачность может быть < 100 %( задаётся  в  Custom Color... ).
     По умолчангию:  [ 14  <r>99</r> <g>99</g> <n>99</n>  1 ]

Файл  Палитры  и  выбранные цвета  можно увидеть  в  КОНФИГУРАЦИИ:  <r>^С</r> .
Они  могут  быть  загружены/ восстановлены:  <r>^S/^R</r> .
В папке:  demo  приведены несколько тестовых Палитр.

<a name='tr'/>
    <b>menu>  Трэки  Максимумов</b>

При поиске  максимумов  используются  параметры  <a href='#his'>Гистограммы Кадра</a>.  Предпологается, что
максимум гистограммы это ШУМ с Нормальным распределением. Для него ищется  центр распре-
деления  и  сигма( средне-квадратичное отклонение ). Увидеть  гистограммы  кадров можно:

<r>^H -"Histogram"</r> - открывает окно ГИСТОГРАММЫ кадра.  Возможности этого окна  совпадают с
     выделенной командой <a href='#his'> hist </a>. Преимущество состоит в том, что  при  последовательном
     просмотре стэка  гистограмма  строится заново для каждого кадра.

При поиске максимумов  рассматриваются  значения, которые  превышают ШУМ:  <r>x0 + U*sigma</r>,
где: x0-центр шума, sigma-СКО,  параметр:  <r>U -"Up noise"-"Выше Шума"</r>,  по умолчанию U=3.

<r>^U</r> - вызывает диалог изменения этого параметра.

Алгоритм строит траектории движения локальных максимумов.  Действующий  алгоритм  трудно
назвать совершенным, но  в  несложных случаях  он  даёт  приемлемые  результаты.

<r>^X</r> - ВКЛЮЧИТЬ/ выключить <r>Трэки Максимумов</r>  на карте .

<r>^Z</r> - ВКЛЮЧИТЬ/ выключить <r>Окно Максимальных Значений</r> .

<r>&lt;F3></r> - сохранить  Трэки Максимумов  в  <a href='#dat'>### файле</a>.   Пример файла :
<f>
### StkMax_1 [ 50, 5 ]			! ЧЁРНЫЙ
!Кадр   Знач.  Апрокс.	  X	  Y
1	403.7	403.4	31.23	 .1065
2	401.4	413.3	26.99	2.292
3	404.4	419.8	23.3	4.693
...</f>
где: имя = <Имя_Стэка>+"Max_"+<номер_трэка>,  комментарий  указывает  цвет трэка.
Сохраняются:  Кадр,  Значение МАКСИМУМА,  Аппроксимиров.Значение   и  Аппроксимированные
координаты на карте: X, Y.  Файл содержит все выделенные трэки.

________________________________________________________________________________________
<a name="fwk"/>
<f>фреимворк  <b>pik3d</b>  v.17.0</f><b>
ОБРАБОТКА и 3D-ОТОБРАЖЕНИЕ  МАТРИЦ/ КАДРОВ и их ПОСЛЕДОВАТЕЛЬНОСТЕЙ/ СТЭКОВ
</b>
При  исследовании  свойств  изменяющейся  во  времени  поверхности,  удобно  хранить,
обрабатывать  и  отображать  совокупность  изображений/ кадров/ матриц,  как одно целое.
Такую  последовательность  кадров  часто  называют  СТЭКОМ  изображений.
Отображение стэка  в  режиме "кадр за кадром"  воспринимается  как  видео-ролик( клип ).

Фреимврорк: <b>pik3d</b>  предлагает  стандарт хранения/ обмена данными  и базовый набор команд
обработки  и  отображения стэков.  Для языка  <b>JAVA</b>  методы  чтения  и  записи файлов  в
<a href="#dat">###-формате</a>  хранятся  в библиотеке:  lib\pik.jar  и  описаны:  <a href='#pik'>методы pik.io</a>.
Для языка  <b>PYTHON</b>  реализован  package:  kadr.py ( хранится:  ext\###_PYTHON.zip ).
Для использования  <a href="#dat">###-формата</a>  в  графическом  редакторе  <b>ImageJ</b>  реализован плагин:
lib\###_Reader_ImageJ.jar ( скопировать в ImageJ\plugins\3D ).

Команды - это исполняемые(.exe) модули и их набор не фиксирован. Использована технология
лончеров("launch"- запускать,начинать), которые инкапсулируют сложную стартовую конфигу-
рацию JAVA-машины. Любой  один  входной  файл  команды  может быть  заменён  на  <b>#</b> - это
значит:  данные  будут  получены  из  стандартного  потока ввода/вывода  или  конвейера.

Фреимворк содержит  простые  средства  создания  новых  команд  на  JAVA.
Дополнительные команды  могут быть реализованы  на любом удобном  алгоритмическом языке.

В простом варианте  программа обработки  представляет собой  батч-скрипт(.bat или .cmd).
От команды к команде данные передаются в виде файлов стандартного формата или средствами
"pipe-line" - конвейера( экономит время и дисковое пространство ).

Фреимворк можно установить на Windows 7, 10.
Версия 18.0 скомпилирована JAVA-17 с использованием javaFX.

<a href="#ins">УСТАНОВКА pik3d</a>
<a href="#dat">###-ФОРМАТ ДАННЫХ: КАДР, СТЭК</a>
<a href="#cmd">КОМАНДЫ</a>

  <a href='#40' >stk   ii  jj  [ nn=1 [v=0]]</a>                    ! Создать  НОВЫЙ СТЭК
  <a href='#fmt'>fmt    Stk  [ T|I2|F4|D8  [ BE|LE ]]</a>           ! Преобразование формата
  <a href='#tt' >| tt                                </a>           ! Вывод Std.Out на Консоль == <r>| fmt #  </r>
  <a href='#ren'>renam  Stk  name  [index=1]</a>                    ! Переименование кадров:  name_NN

  <a href='#get'>get      Stk i j k [ ni=-1 [ nj=-1 [ nk=-1]]]</a>  ! получить часть СТЭКА
  <a href='#put'>put Part Stk i j k [ ni=-1 [ nj=-1 [ nk=-1]]]</a>  ! заменить часть СТЭКА
  <a href='#add'>add Part Stk i j k [ ni=-1 [ nj=-1 [ nk=-1]]]</a>  ! прибавить  к   СТЭКУ

  <a href="#60" >gauss         [r=2 [ width=3 ]]</a>                ! Нормированный Фильтр Гаусса
  <a href="#bel">bell  K "i j h r"   ["i1 j1 h1 r1"    ["i2 j2 h2 r2"   ]]</a> ! Прибавить "Колокол"Гаусса
  <a href="#wav">wave  K "i j h r a" ["i1 j1 h1 r1 a1" ["i2 j2 h2 r2 a2"]]</a> ! Прибавить "Волну"  Гаусса
  <a href="#gel">gelan   File.cfg</a>                                          ! "ГЕнерация ЛАНдшафта"

  <a href="#112">tra    Stk</a>                                     ! Транспонирование ВСЕХ КАДРОВ СТЭКА
  <a href="#112">rot90  Stk</a>                                     ! Поворот ВСЕХ КАДРОВ на 90 градусов
  <a href="#120">sv  S "+-*/^" value</a>                            ! Операции СТЭК-число
  <a href="#130">ss  A "+-*/^" B</a>                                ! Операции СТЭК-СТЭК

  <a href="#140">noise     Stk  [amp=.1]</a>                        ! Прибавить  Равномерный  ШУМ
  <a href="#160">top       Stk   ur</a>                             ! "ОТРЕЗАТЬ СВЕРХУ"
  <a href="#170">bot       Stk  [ur=0]</a>                          ! "ОТРЕЗАТЬ СНИЗУ"
  <a href="#180">blur      Stk  [r=2]</a>                           ! Сглаживание фильтром "Gauss Blur"
  <a href="#190">filtr     Stk   Fltr</a>                           ! Фильтрация

  <a href="#200">ms    Stk  [ N=5 ]</a>                             ! СКОЛЬЗЯЩАЯ  СУММА   по N кадрам
  <a href="#210">mm    Stk  [ N=5 ]</a>                             ! СКОЛЬЗЯЩЕЕ  СРЕДНЕЕ
  <a href="#220">smm   Stk  [ N=5     [ ur=0 ]]</a>                 ! ВЫЧИТАНИЕ СКОЛЬЗЯЩЕГО СРЕДНЕГО
  <a href="#230">mdis  Stk  [ N=5     [ ur=0 ]]</a>                 ! СКОЛЬЗЯЩАЯ  ДИСПЕРСИЯ
  <a href="#240">srm   Stk  [ alf=0.1 [ ur=0 ]]</a>                 ! ВЫЧИТАНИЕ  РЕКУРЕНТНОГО  СРЕДНЕГО
  <a href="#250">sam   Stk  [ N=5     [ ur=0 ]]</a>                 ! ВЫЧИТАНИЕ "НАКОПЛЕННОГО" СРЕДНЕГО
  <a href="#260">mad   Stk  [ N=5     [ ur=0 ]]</a>                 ! "НАКОПЛЕННАЯ" ДИСПЕРСИЯ

  <a href="#s3d">s3d   Stk  [ config | _  [main [delaySec ]]]</a>   ! Визуализация 3D-поверхности

  <a href="#his">hist  Stk   kadr    [ Nint=500]</a>                ! Гистограмма Кадра

  <a href="#vis">vic   Stk  [Kadr=1] [jx=0] j1 [j2 [j3 [...]]]</a>  ! Визуализация <r>СТОЛБЦОВ</r> Кадра
  <a href="#vis">vics  ---"---"---"---"---"---"---"---"---"---</a>  ! --"---"---"---"---"-- <r>СПЛАЙНОМ</r>
  <a href="#vis">vil   ---"---"---"---"---"---"---"---"---"---</a>  ! Визуализация  <r>СТРОК</r>   Кадра
  <a href="#vis">vils  ---"---"---"---"---"---"---"---"---"---</a>  ! --"---"---"---"---"-- <r>СПЛАЙНОМ</r>
        <a href="#gra">работа с графическими окнами</a>

  <a href="#tif">tif   File.tif | Config  [Npro=99999]</a>          ! Просмотр .TIF-КЛИПОВ

  <a href="#jj" >jj    File.java  [arg1 ...]</a>                    ! ИСПОЛНИТЬ       File.java
        <a href="#pik">наиболее употребительные методы pik.io

  <a href="#jc" >jc    File.java            </a>                    ! СКОМПИЛИРОВАТЬ  File.java
        <a href="#jc" >создание  новой  КОМАНДЫ</a>                 ! подготовка  ЛОНЧЕРА
________________________________________________________________________________________
<b><a name="ins">
                        УСТАНОВКА  pik3d
</b>
 1. Скачать установочный .zip-архив <r>Open JDK+FX( Full ) v.17</r> для Windows( x86 64bit ).
    Рекомендуется использовать сборку Российской компании "BELLSOFT": 

      <a href="https://libericajdk.ru/pages/downloads/#/java-17-lts%20/%20current"
       >https://libericajdk.ru/pages/downloads/#/java-17-lts%20/%20current</a>

    Можно использовать JRE(Java Runtime Environment ~74 MB) вместо JDK(Java Development
    Kit ~257 MB).  В JRE отсутствует  JAVA  компилятор,  что  не позволит  использовать
    команду:  <a href="#jj">jj - исполнить File.java</a>  ( команда не очень важная ).
    Это имеет смысл  для первоначального  знакомства  с  <b>s3d  и  фреимворком</b>  или  для
    экономии  трафика  и  диска.  Скачать можно там же:  <r>JRE+FX( Full ) v.17 </r>.
	
 2. Развернуть архив, например в: D:\jdk. Должна быть папка: D:\jdk\bin с java.exe.

 3. Развернуть архив: <r>pik3d.zip</r> в папке, например: E:\pik3d .

 4. Создать системную переменную среды:  <r>PIK3D_JAVA</r> :
    - Панель управления/ Система и безопасность/ Система/ Доп. параметры системы/
        Переменные среды/ Создать/ <r>PIK3D_JAVA</r>
    - Ввести значение:  <r>< папка с java.exe >; < class-path ></r>
      В нашем примере:  D:\jdk\bin; E:\pik3d\lib\*

 5. Добавить в переменную среды  <r>Path</r>  путь к исполняемым модулям pik3d
      В нашем примере:  ...;E:\pik3d\exe

 6. Если в системе установлен антивирус, рекомендуется просканировать папку:  pik3d.
    Например в AVAST это делается так:  Protection/ Virus Scans/ Targeted Scan/ отметить
    галочкой папку: pik3d / OK .

 7. Проверить правильность установки:  консоль> <r>gauss| s3d #</r>
    Должен отобразиться колокол Гаусса.
    В случае ошибки, проверьте <r>PIK3D_JAVA</r> и <r>Path</r>:
      > echo %PIK3D_JAVA%
      > echo %Path%
    Возможно требуется рестарт Windows.
    Так же причиной может быть конфликт с антивирусом( пройдёт через некоторое время ).

 8. В папке:  <r>pik3d\demo</r>   запустить  <r>___DEMO.cmd</r>.
    После генерации данных будет запущен  <r>s3d</r>  c  demo-конфигурацией( cfg.s3d ).
    Каждые 30 сек будет появляться инфо.сообщение:  Переход к следущему стэку:  <r>^N</r>.
    Для отключения сообщения: нажать ^C, в появившемся окне поставить # перед  <r>msg:</r> ,
    нажать кнопку:  Установить.
    При остановленном просмотре  можно  менять  3D-ракурс  движением  нажатой  Мыши.
    Рекомедуется в разных  последовательностях  понажимать :
    <r>&lt;F1>, ^3(три) -Линии, ^D-"Дно", ^A-Оси, ^M -Карта</r>, ^-означает нажатую клавишу &lt;Ctrl>
    В справочнике действует стандартная HTML навигация:  &lt;Home>, &lt;End>, <a href="#ins">"линки"</a> ...
________________________________________________________________________________________
<b><a name="dat">
                        ### - ФОРМАТ  ДАННЫХ:  КАДР,  СТЭК :
</b>
Файл  может содержать  один  или несколько кадров текстовых и/или бинарных.
Кадр = Матрица  в  математическом  понимании. Ниже слово "столбец"  может быть  заменено
словом "колонка".

Данным кадра предшествует заголовок:  <r>### имя_кадра [ Кол.строк, Кол.столбцов ]</r>.
Имя кадра может быть любым текстом( возможно с пробелами ). В скобках  размер  матрицы.
Размер может быть указан в круглых скобках: <r>### имя(Кол.строк, Кол.столбцов)</r>.
Имя кадра - необязательный параметр( важен пробел после <r>"### "</r>).

Файлы  данных  текстовые  или  бинарные  могут содержать  комментарии.
<r>Комментарий начинаются с '!' или одиночной '#'</r>  и  заканчивается  в  конце  строки.
Пустая строка тоже считается комментарием.

В  <r>Текстовом Формате</r>  после строки заголовка  следуют  строки данных.  Данные считаются
вещественными числами, даже если  не содержат  десятичную  точку.  В качестве  символов
данных  рассматриваются: <r>"-+.0123456789eE"</r>,  остальные  игнорируются,  т.е. могут  быть
разделителями( например: ",;'tab''space'/|\()[]{}<>_abc%циф=...").

Строку можно делить  на  любое количество подстрок  и  помещать комментарии между ними.
! пример:
 ### test [ 3, 5 ]    ! 3-строки, 5-столбцов

   11.123, 12.34, 13                      # это комментарии
                        -14,     15.56    ! можно использовать:
                                          ! - целые числа
   21.32   22.54 -23.33  24.765  -.25E+8  ! - вещественные: с плавающей точкой
   31      32     3.3e1  340e-7  3.5e+13  !   и/или экспонентой

<r>Бинарный Формат</r> имеет расширенный заголовок.  После размера матрицы  следует  тип
бинарных данных: <r>I2 | F4 | D8</r>  и  возможно "индикатор порядка байтов": <r>BE | LE</r> .

    <r>I2</r> - 2-байтовые целые, диапазон целых значений от -32768 до +32767
    <r>F4</r> - 4-байтовые вещественные точность ~ <r>7</r> значащих цифр:
                          <r>1.4e-45</r>  < абс.величина < <r>3.4e+38</r> ;
    <r>D8</r> - 8-байтовые вещественные(двойная точность), <r>~15</r> значащих цифр:
                          <r>4.9e-324</r> < абс.величина < <r>1.8e+308</r> .

    <r>BE</r> - "Big-Endian"    - "СТАРШИЕ байты вначале"
    <r>LE</r> - "Little-Endian" - "МЛАДШИЕ байты вначале" - default( можно опускать ).

Бинарный блок начинается после байта=0x10=#0A("Line Feed") и не содержит комментариев !
Комментарии  могут быть  только  перед заголовком  или  после  бинарного  блока !

В бинарный блок данные выводятся последовательно по строкам без разделителей !
<r>
    ВСЕ БАЗОВЫЕ КОМАНДЫ  ЧИТАЮТ  ДАННЫЕ В ЛЮБОМ ФОРМАТЕ( указан в заголовке )
    БОЛЬШИНСТВО КОМАНД  ВЫВОДЯТ  ДАННЫЕ В ФОРМАТЕ: <b>F4  BE</b> - 4-байтовые вещественные !
</r>
Команда:<a href="#122"> fmt -"format"</a> конвертирует файл в указанный формат( по умолчанию в текст ).
Например:  вывести  результат  команды  или  конвейера  на экран  ><r> ...| fmt #</r> .
Ввиду частоты использования: <r>| fmt #</r>  введена короткая форма: <r>| tt</r> - <a href='#tt'>"Type Terminal"</a>.

Методы работы с данными на языке JAVA приведены:  <a href="#pik">методы pik.io</a> .
________________________________________________________________________________________
<b><a name="cmd">
                                КОМАНДЫ:
</b>
Команды это исполняемые .exe-модули( pik3d\exe\*.exe ).
Они реализованы  на  JAVA, хранятся  pik3d\lib\*.jar, а запускаются специальными
.exe-программами - лончерами( "launch" - запускать, начинать ).  Действия лончера :
 - запускает JAVA-машину в конфигурации необходимой команде: ключи, пути, библиотеки...;
 - передаёт ссылку на JAVA-класс команды( скомпилированный код команды ) ;
 - передаёт аргументы команде ;
 - после запуска JAVA-машины и передачи параметров завершает работу .

Все лончеры имеют одинаковый код. Разница в параметрах старта и ссылке на класс команды.
Создание команды и подготовка лончера описаны:  <a href="#jc">jj, jc, новая команда</a>.

   <r>При первом старте команд может возникать конфликт с антивирусом.
   После проверки лончера антивирусом это проходит</r>

Имя команды = имени лончера( имена не фиксированы ). Пользователь может переименовать
лончер по своему усмотрению.

Информацию о JAVA-машине и  путь к библиотекам  лончер получает из переменной окружения:
<r>PIK3D_JAVA</r> см.<a href="#ins"> установка pik3d</a>. Использование этой технологии  позволяет иметь несколько
разных JAVA-машин и библиотек в системе.

Многие команды при вызове без параметров выводят ошибку и своё описание.
Если команда ничего не показывает, её  нужно запустить  в режиме отладки - ключ: <r>/dbg</r> .
Кроме того, некоторые диагностические сообщения видны только в режиме отладки.

Большинство команд( за исключением команд визуализации) посылают результат в стандартный
поток ввода/вывода.  Если не указать  "> File"  в конце команды  -  вывод осуществится
на консоль/ экран.

Стандартный поток позволяет использовать технологию  <r>конвейера ( "pipe-line" )</r>.
Если промежуточные данные не важны, они могут передаваться от одной команды к другой на-
прямую,минуя файл на диске.Это экономит дисковое пространство и повышает быстродействие.
Для использования конвейера, команды пишутся в одну строку  и  разделяются символом <r>'|'</r>.
Если команда получает стэк из конвейера, то этот параметр заменяется на <r>'#'</r>.

   stk 70 90 <r>|</r> noise <r>#</r> <r>|</r> bell <r>#</r> "20 30 .3 10" <r>|</r> wave <r>#</r> "50 60 .2 15 45" <r>></r> Land
или
   stk 70 90 <r>|</r> noise <r>#</r> <r>|</r> bell <r>#</r> "20 30 .3 10" <r>|</r> wave <r>#</r> "50 60 .2 15 45" <r>|</r> s3d <r>#</r>

Ограничения конвейера:
  - В команде может быть <r>только один #</r> параметр.
  - Ни один из входящих файлов не должен иметь имя результата( в примере: Land )
________________________________________________________________________________________
<b><a name="40">
      stk  ii  jj  [ nn=1  [ v=0 ]]   >   File
</b>
Создать новый СТЭК :
    ii  - количество строк;
    jj  - количество столбцов;
    nn  - количество кадров;
    v   - значение элементов кадра[ по умолчанию 0 ].

Примеры:
  stk  22  33         > b2233    ! 1 кадр:  33 строки 33 столбца ,  заполненный  0 ;
  stk  25  46  1  -1  > b2233_1  ! 1 кадр:  25 строк  46 столбцов,  заполненный -1 ;
  stk  22  33  50     > s50      ! стэк из 50 кадров: [ 22,33 ], заполн. 0   ;
  stk  42  65  99 .2  > s99_02   ! стэк из 99 кадров: [ 42,65 ], заполн. 0.2 .
________________________________________________________________________________________
<b><a name="fmt">
      fmt   Stk  [ T | I2 | F4 |D8   [ BE | LE ]]   >   File
</b>
Конвертировать  Stk  в  File( cтэк другого формата ).
Стэк может быть папкой( упорядочивание файлов по алфавиту ).

Допустимые  <a href="#dat">форматы:</a>
    T  - текстовый ;
    I2 - бинарный:  короткие целые      2 байта  ;
    F4 - бинарный:  с плавающей точкой  4 байта  ;
    D8 - бинарный:  двойная точность    8 байтов .

правила:<r>
       - Если формат опущен - подразумевается ТЕКСТОВЫЙ
       - Если не указан порядок байтов - принимается BE ="Big Endian"( Java Standard )
       - Можно использовать нижний регистр:  t|i2|f4|d8  be|le
</r>
Примеры:
  fmt q d8 LE > qd8  - конвертировать q в qd8: D8 LE
  fmt  stk           - вывод на экран стэка в текстовом виде;
  ...| fmt # i2 le > qi2le - результат "pipe-line" сохранить в виде:  I2 LE.
  ...| fmt #               - результат "pipe-line" на экран  в виде  текста.
  ...<r>| tt </r>                 - результат "pipe-line" на экран  в виде  текста, см. ниже.
________________________________________________________________________________________
<b><a name="tt">
      | tt     ==    | fmt  #         !  Вывод  Std.Out / результата "pipe-line"  на  КОНСОЛЬ
</b>
Рекомендуется применять  <r>| tt</r>  вместо:  <r>| fmt #</r> !!!
Преимущества:
  - короче ;
  - решается проблема  русского текста  при выводе  на консоль.

Пример( обратите внимание на <r>имена кадров</r> ):
> stk 2 4 3| renam # РУССКИЙ_ШРИФТ| fmt #        ! "Русификация" имён кадров
> stk 2 4 3| renam # РУССКИЙ_ШРИФТ| fmt #| tt    <r>
> stk 2 4 3| renam # РУССКИЙ_ШРИФТ| tt           ! рекомендуется !</r>
________________________________________________________________________________________
<b><a name="ren">
      renam   Stk   name   [index=1]   >   File
</b>
Переименовать кадры - создать новый File-cтэк, в котором кадры имеют последовательные
имена:  name_NN , начинаются с NN = index.

    <r>!!!  ВХОДНОЙ  СТЭК  НЕ  МОЖЕТ  БЫТЬ  ПАПКОЙ  !!!</r>

Примеры:
  renam  q data     > q123  ! в q123 кадры: data_1, data_2 ...
  renam  q back -2  > q_50  ! в й_50 кадры: back_-2, back_-1, back_0, back_1 ...
________________________________________________________________________________________
<b><a name="get">
      get  Stk  i j k  [ ni=-1 [ nj=-1 [ nk=-1 ]]]  >  File
</b>
Новый Cтэк, который является частью Stk.
Внутренний Параллелепипед( ВП ) определяется:

   i,  j,  k - начальные значения строк, столбцов, кадров;
  ni, nj, nk - количество: строк, столбцов, кадров;
  -1 значение по умолчанию для ni, nj, nk означает: "ВСЕ ОСТАВШИЕСЯ".

Примеры для Stk[ 20,30,40 ] :

  если k=9, nk=-1 --> <кол.кадров> = 40-9+1 = 32, кадры: 9,10,11...40

  get Stk 4 5 6          > Part  ! i=4..20, j=5..30, k=6..40,  часть: [ 17,26,35 ]
  get Stk 4 5 6  ,,8     > Part  ! содержит часть: [ 17,26, 8 ]
  get Stk 1 1 5  ,,1     > Part  ! содержит 5-й кадр
  get Stk 4 5 7  11 22 1 > Part  ! содержит часть 7-го кадра: [11,22]
________________________________________________________________________________________
<b><a name="put">
      put  Part  Stk  i j k  [ ni=-1 [ nj=-1 [ nk=-1 ]]]  >  File
</b>
Новый Стэк, который получен заменой части Stk, т.е. Стэк Part заменяет часть Stk.
Внутренний Параллелепипед(ВП) Stk( i,j,k )[ ni,nj,nk ]  (см.<a href="#get">get</a>) заменяется Стэком Part.

  - Если ВП выходит за пределы Stk, он приводится к допустимому размеру
  - Если размер Part больше ВП, то помещается часть Part размером ВП
  - Если размер Part меньше ВП, то изменится не весь ВП
  - i, j, k могут быть <=0 это значит: ВП начинается ВНЕ Стэка !!!

        <r>!!!  В Stk МЕНЯЕТСЯ <b>ПЕРЕСЕЧЕНИЕ</b> Part и ВП  !!!</r>

Пример  ВП  для 50 кадров:
k=23, nk=-1:  <кол.кадров> = 50-23+1 = 28, т.е. 23,24,25 ... 50.
________________________________________________________________________________________
<b><a name="add">
      add  Part  Stk  i j k  [ ni=-1 [ nj=-1 [ nk=-1 ]]]  >  File
</b>
Новый Стэк, который получен прибавлением к части Stk  стэка  Part.
Значения Внутреннего Параллелепипеда(ВП)  Stk( i,j,k )[ ni,nj,nk ]  заменяются суммами
соответствующих значений: Stk и Part.  Правила ВП такие же как в <a href="#put">put</a>.

Пример для сравнения  <r>put и add</r> :
1. Генерация <r>Part</r> с помощью <a href="#gel">gelan</a> :<f>
#  file: part.gel:
   size: 9, 23, 15
   bell:
      h: (1 1) (8 6) (15 1)
      x: 5
      y: 5 1
      r: 4</f>
   > gelan part > <r>Part</r>  ! генерация
   > s3d <r>Part</r>           ! просмотр

2. Создаём  <r>Stk</r> :
   > stk 32 48 33 1| noise # .3| blur # .7 > <r>Stk</r>

3. Делаем 3 раза <r>put</r> и смотрим :
   > <r>put</r> Part Stk 2 2 2| <r>put</r> Part <r>#</r> 12 27 17| <r>put</r> Part <r>#</r> 23 15 9| s3d <r>#</r>

4. Делаем 3 раза <r>add</r> и смотрим :
   > <r>add</r> Part Stk 2 2 2| <r>add</r> Part <r>#</r> 12 27 17| <r>add</r> Part <r>#</r> 23 15 9| s3d <r>#</r>
________________________________________________________________________________________
<b><a name="60">
      gauss   [ R=8 [ width=3 ]]   >   File
</b>
Вывести  в File  нормированный фильтр Гаусса  заданного радиуса  и  аппертуры( ширины ):
Фильтр осуществляет <r>"РАЗМЫТИЕ / СГЛАЖИВАНИЕ"</r> изображения без смещения - "Gauss Blur".
Нормированный  означает - сумма всех значений фильтра = 1.

Для распределения Гаусса  принято  считать  <r>радиус = R = 2*сигма</r>.
Это  визуально  воспринимаемый  радиус  колокола  и  характерный  размер "СГЛАЖИВАНИЯ".

    <r>После сглаживания  остаются  детали,  у которых размер  больше  радиуса.</r>

Аппертура фильтра или ширина(2-й параметр) измеряется в радиусах(по умолч.=3*R= 6*sigm )
По "Требованию Центральной Точки"округляется ВВЕРХ к ближайшему нечётному: 3*8=24 --> 25
> gauss 3.5 2.8 > filtr    ! 3.5*2.8 = 9.8 --> 11,   размер: 11 x 11 точек.
________________________________________________________________________________________
<b><a name="bel">
      bell  K  "i j h r"  ["i1 j1 h1 r1"  ["i2 j2 h2 r2"]...]   >  File
</b>
К - Стэк состоящий из одного кадра !!!
Прибавить в указанное место кадра: <r>i,j</r>  "Колокол" Гаусса заданной высоты и радиуса: <r>h, r</r>
Параметры i,j могут быть <=0, т.е. точка находится вне кадра, h<0-"яма", r>0 всегда !

Параметры "Колокола" <r>задаются в кавычках!</r> Нет значений по умолчанию!
В одной команде можно задать <r>несколько</r> "Колоколов".
Радиус "Колокола" = 2*сигма( в терминах функции Гаусса ).

Пример:
> stk 17 33 1 | <r>bell # "9 11 9 9" "9 22 -9 9"</r> | s3d #
________________________________________________________________________________________
<b><a name="wav">
      wave  K  "i j h r a"  ["i1 j1 h1 r1 a1"  ["i2 j2 h2 r2 a2"]...]   >  File
</b>
К - Стэк состоящий из одного кадра !!!
К кадру  прибавить "Волну" Гаусса: ширина = 2*r = 4*sigma, высота = h.
Положение "Волны": i,j - строка/столбец точки, через которую проходит "Волна",
a - угол отсчитывается в градусах от вертикальной оси ПРОТИВ ЧАСОВОЙ СТРЕЛКИ, т.е.
если мы смотрим на кадр как на матрицу, то направление вниз("на 6 часов") = 0 град.,
вправо("на 3 часа") - 90 град., вправо вверх("на 1 час") - 90+66 = 156 град.

Параметры i,j могут быть <=0, т.е. точка находится вне кадра, h<0-"яма", r>0 всегда !
Параметры "Волны" <r>задаются в кавычках!</r>  Нет значений по умолчанию!
В одной команде можно задать <r>несколько</r> "Волн".

Пример:
> stk 23 33 1| <r>wave # "12 17 -9 7 60" "12 17 11 9 -45"</r> | s3d #
________________________________________________________________________________________
<b><a name="gel">
      gelan   Config[ .gel ]   >   File   !  "<r>GE</r>negate  <r>LAN</r>dscape"  -  <r>ГЕ</r>енерация  <r>ЛАН</r>дшафта.
</b>
Создание СТЭКА с движущимися и/или неподвижными ФИГУРАМИ.
Возможно создание ОДНОГО КАДРА( size ii jj <r>1</r> ).
Рекомендуется использовать для файлов конфигурации расширение: <r>.gel</r> ,
его можно опускать при вызове.

Координатам "X,Y" в кадре соответствуют "Cтроки, Столбцы  Матрицы Кадра",
т.е. ось 'OX' направлена вниз( по строкам ), а ось 'OY' - вправо( по столбцам ).
Углы отсчитываются от оси 'OX' ПРОТИВ ЧАСОВОЙ СТРЕЛКИ,
т.е. направление сверху вниз имеет угол = 0.

Генерация задаётся конфигурационным файлом, который включает:
! Коментарий: часть строки начиная со знака: '!' или '#',
              пустая строка считается коментарием.

<r>size:</r> ii, jj, kk  ! размеры генерируемого СТЭКА, где:
      ii - количество строк, jj - к-во. столбцов, kk - к-во. кадров( возможно 1 ).

ЛЮБОЙ ПАРАМЕТР может быть задан:
  - константой или
  - ПОЛИНОМОМ  ОТ  ВРЕМЕНИ( t=k-1, где k-номер кадра )
Если параметр НЕ ЗАДАН, он считается равным 0 !

Полином первой степени P1 можно задать двумя числами A1, V:  p = A1 + V*t,
где:  t = k-1 ;
     A1 - значение на 1 кадре;
      V - изменение параметра при переходе к следующему кадру = <r>скорость изменения</r>.

Альтернативный способ задания P1 - задать два значения: p1,p2 в разных кадрах: k1,k2:
(k1,p1) (k2,p2)
тогда:  V = (p2-p1)/(k2-k1),  A1 = p1 - V*(k1-1) ;

В качестве разделителей можно использовать:  'пробел' | <Тab> | ',' | '(' | ')'

Полиномы  P2  и  P3  так же можно задать 2 способами:
 - Непосредственно списком коеффициентов A1,V,A2,A3:  p = A1 + V*t + A2*t*t + A3*t*t*t
 - Или перечислением точек, через которые он проходит:  (k1,p1) (k2,p2) ... ,  где:
   k1, k2 ... - номера кадров,  p1, p2 ... - соответствующие значения параметра.
Примеры:
   y: (1,2)         (25,76)         (50,10) , где y задан полином 2-го порядка:
!  y в 1 кадре =2, в 25 кадре =76, в 50 кадре =10

   x: (1,26)  (17,6)  (35,40)  (50,34)   - изменение 'x' задано полиномом 3-го порядка

Увидеть реальные коеффициенты полинома можно на консоли сразу после запуска gelan.

Параметры СТЭКА:
 <r>add:</r>   <смещение>        ! прибавляется  ко всем значениям, может зависеть от времени ;
 <r>noise:</r> <амплитуда шума>  ! Равномерный Шум [-ампл., ампл.], может зависеть от времени ;
 <r>blur:</r>  <радиус размытия> ! Гауссово размытие с сигмой = R/2 после построения кадра .

Возможно любое количество ФИГУР типа:  <r>bell:</r>(колокол), <r>wave:</r>(волна), <r>poly:</r>(полигон).

Каждый параметр фигуры имеет имя с двоеточием: <r>x:, ry:,  p[]: </r>...
За именем следует "значение", которое может быть полиномом от времени.
Полином может быть задан коеффициетами или точками, через которые он проходит.

За названием фигуры можно поместить краткое описание без знаков коментария: '!','#'.
Оно буде выведено на консоль при генерации.

Порядок задания параметров фигуры может быть ЛЮБЫМ !!!

Параметр: <r>k01 может "включать/ выключать" фигуру</r>.
Если параметр: k01 не задан - фигура видна всегда.
Пример: k01: (4,9) (12,19) (21,39) ! фигура видна на кадрах:  4..9, 12..19, 21..39.
                                   ! на остальных кадрах она будет отсутствовать
Стэк генерируется в формате: F4 BE.
В начало Стэка в виде коментария помещаются:  дата  и  конфиг.файл.

                                    <r>ФИГУРЫ:</r>
<r>bell:</r>   [ описание ]             !
   h:   <высота>                 ! <r>"КОЛОКОЛ"</r> Гаусса
   x:   <Х-координата центра>    !
   y:   <У-координата центра>    !
   r:   <радиус = 2*сигма>       ! колокол в сечении КРУГ c радиусом r на высоте =.14*h
   rx:  <радиус в направлении X> ! если заданы rx и ry, колокол в сечении ЭЛЛИПС
   ry:  <радиус в направлении Y> !
   a:   <угол поворота в град.>  ! поворот фигуры вокруг верт.оси проходящей через: x,y
   k01: (k0,k1) ...              ! интервалы видимости( с кадра k0 по k1 включительно )

<r>wave:</r>   [ описание ]             !
   h:   <высота>                 ! <r>"ВОЛНА"</r> Гаусса
   x:   <Х-координата центра>    !
   y:   <У-координата центра>    !
   r:   <радиус = 2*сигма>       ! видимая ширина волны ~ 2*r
   a:   <угол поворота в град.>  ! в матрице кадра поворот от "направления вниз"
   k01: (k0,k1) ...              ! интервалы видимости( с кадра k0 по k1 включительно )

<r>poly:</r>   [ описание ]             ! <r>"ПОЛИГОН"</r> задаётся контуром: "p[]"
   h:   <высота>                 ! все точки входящие в контур полигона имеют высоту h !
   x:   <Х-координата центра>    ! X - положение  центра полигона* в кадре
   y:   <У-координата центра>    ! Y - положение  центра полигона* в кадре
   a:   <угол поворота в град.>  ! поворот вокруг центра полигона*
   p[]: [ координаты (x,y) ]     ! массив координат полигона: (x1,y1) (x2,y2) (x3,y3)...
        ! *центром полигона считается точка, от которой отсчитываются  x1,y1,  x2,y2 ...
        !  последняя точка автоматически соединяется с первой( полигон замкнутый )
   k01: (k0,k1) ...              ! интервалы видимости( с кадра k0 по k1 включительно )

#==================================================== пример реального конфиг.файла:

size: 52, 80, 50  ! 52 строки, 80 колонок, 50 кадров

add:   (1,-5) (26,44) (50,-5) # изменяется во времени !
noise: (1,5) (26,33) (50,3)   ! изменяется во времени !
blur:  (1,0) (26,3) (50,1)    ! изменяется во времени !

bell:       круглый горб движется ~ по синусоиде
  h: 99
  x: (1,1) (17,43) (34,9) (50,33)   ! P3
  y: 1 1.6
  r: 5

bell:       круглый горб - движ. по параболе снизу в верх затем вниз
  h: 111
  x: (1,48) (26,4) (50,48)          ! P2
  y: 1 1.6
  r: 7

bell:       эллиптический горб движ. по замкнутой кривой, крутится -15 гр/кадр
  h: 133
  x: (1,26) (17,6) (35,40) (50,34)  # P3
  y: (1,2) (26,76) (50,10)
  rx: 7
  ry: 2
  a:  30 -15 ! крутится -15 гр/кадр по час.стрелке

poly:       полигон: СТРЕЛКА крутится 9 гр/кадр, движ. снизу слева на право в верх
  h: 20 1.3
  x: 40 -.6
  y: 2  1.6
  p[]: (0,0) (10,-10) (0,20) (-10,-10)
  a: 0  9    # крутится  9 гр/кадр против час.стрелки
________________________________________________________________________________________
<b><a name="112">
      tra    Stk  >  File
</b>
Транспонирование ВСЕХ КАДРОВ СТЭКА,т.е. столбцы кадров Stk станут строками нового стэка.
Можно понимать, как переворот вокруг диагонали из левого верхнего в правый нижний угол.
<b>
      rot90  Stk  >  File
</b>
Поворот КАДРОВ СТЭКА на 90 град. можно понимать, как поворот  относительно центра кадра
на 90 град. ПРОТИВ ЧАСОВОЙ СТРЕЛКИ.
Пример для кадра [ m, n ]  -  m-строк, n-столбцов:

   исходный     конечный
   [ m, n ] --> [ n, m ]  - размеры.
   ( 1, 1 ) --> ( n, 1 )
   ( m, 1 ) --> ( n, m )
   ( m, n ) --> ( 1, m )
   ( 1, n ) --> ( 1, 1 )
________________________________________________________________________________________
<b><a name="120">
      sv   Stk   ( + | - | x | / | ' | exp | ln | db )   Value   >   File
</b>
Операции "<r>S</r>tack <r>V</r>alue" применяются  ко  всем  элементам Стэка.

  Арифметические операции:
    +, -, <r>x-умножить(латинск.x)</r>, /-разделить, <r>' -возвести в степень( одинарная кавычка )</r>

  Функции <элемент Стэка>/value:
    exp = exp  ( stk / value )  - "e" в степени отношение: <елемент Стэка>/value
    ln  = ln   ( stk / value )  - натуральный логарифм( основание "e" )
    db  = 10*lg( stk / value )  - децибел мощности( десятичный лог.)

    sv  Stk  +  200  >  F    ! ко всем элементам прибавить 200
    sv  Stk  -  100  >  F    !
    sv  Stk  x  -1   >  F    ! у всех элементов поменять знак( умножить на -1 )
    sv  Stk  /   4   >  F    !
    sv  Stk  '   2   >  F    ! все элементы возвести в квадрат
    sv  Stk  '  .5   >  F    ! из всех элементов извлечь квадратный корень,
                             ! т.е. возвести в степень 1/2

*можно опускать пробел перед value:
    sv Stk +1;  sv Stk /2;  sv Stk '.5;
    sv Stkq - -3  ==  sv Stk --3   ! sv Stk +3 !!!

*имя функции можно сокращать до ОДНОЙ буквы( e, l, d ):
    sv Stk e -2 == sv Stk exp -2   ! exp( -Stk[]/2 )
________________________________________________________________________________________
<b><a name="130">
      ss   A   ( + | - | x | / | ' )   B   >   File
</b>
Поэлементные операции со стэками "<r>S</r>tack <r>S</r>tack".

  ss  A  +  B   >  F  ! поэлементное СЛОЖЕНИЕ стэков:          Fij = Aij + Bij
  ss  A  -  B   >  F  ! --:--:--:--  ВЫЧИТАНИЕ:                Fij = Aij - Bij
  ss  A  x  B   >  F  ! --:--:--:--  УМНОЖЕНИЕ(<r>латинское x</r>):   Fij = Aij x Bij
  ss  A  /  B   >  F  ! --:--:--:--  ДЕЛЕНИЕ:                  Fij = Aij / Bij
  ss  A  '  B   >  F  ! --:--:--:--  ВОЗВЕДЕНИЕ В СТЕПЕНЬ:     Fij = Aij ' Bij

* СТЭКИ ДОЛЖНЫ ИМЕТЬ КАДРЫ ОДИНАКОВОГО РАЗМЕРА !
* Количество кадров результата = количеству кадров <r>более короткого</r>.
* Знак возведения в степень - одинарная кавычка.
________________________________________________________________________________________
<b><a name="140">
      noise   Stk   [amp=.1]   >   File
</b>
Прибавить равномерный(белый) ШУМ с амплитудой amp. Он имеет равномерное распределение на
интервале: [-amp, amp ],  по умолчанию  amp = 0.1 .

  noise  surf1      >  surf1   ! к  стэку: surf1  добавить ШУМ с амплитудой = .1
  noise  surf2  .3  >  surf2   ! к  стэку: surf2  добавить ШУМ с амплитудой = .3
  stk 7 7 3| noise # 1| tt     ! создать стэк из 3 кадров[7,7],  добавить ШУМ( amp=1 )
                               ! и вывести стэк на консоль
________________________________________________________________________________________
<b><a name="160">
      top   Stk   ur   >  F
</b>
<r>"Отрезать СВЕРХУ"</r> - заменить "уровнем"= ur  все <r>значения > ur</r> в стеке.
! 2 обязательных параметра !
________________________________________________________________________________________
<b><a name="170">
      bot   Stk  [ur=0]   >  F
</b>
<r>"Отрезать СНИЗУ"</r>  - заменить  "уровнем"= ur  все <r>значения < ur</r> в стеке.
По умолчанию( если не задан ) ur= 0.
________________________________________________________________________________________
<b><a name="180">
      blur   Stk  [R=2]   >  F
</b>
Ко всем кадрам стэка применить фильтр: <r>"Gauss Blur"( размытие )</r> заданного радиуса R.
Радиус - характерный размер размытия( элементы меньшего размера пропадут ).
По умолчанию R=2, но может быть например:  1.2,  1.75,  3.5  ...
Ширина( аппертура ) фильтра = 3*R = 6*sigma, т.е. при R=2 суммирование для каждой точки
будет проводится на квадрате 7x7 ( 3*R=3*2, +1 -"Требование Центральной Точки").
________________________________________________________________________________________
<b><a name="190">
      filtr   Stk   Fltr   >  F
</b>
Ко всем кадрам стэка применить  <r>цифровой Фильтр</r>.
Fltr - кадр/матрица  с  коеффициентами фильтра.
Например  фильтр  можно получить так:  > gauss  3.5  2.8  >  Fltr    ! размер: 11x11
Фильтр может быть не нормирован( сумма коеф. != 1 ).
Нормирование Фильтра делается командой автоматически.
________________________________________________________________________________________
<r>
   &#9556&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9559
   &#9553    КОМАНДЫ  "СКОЛЬЗЯЩЕГО СУММИРОВАНИЯ"  ПРИМЕНИМЫ  К  СТЭКУ  ДЛИНОЙ  >  1     &#9553
   &#9553                                                                               &#9553
   &#9553        N - интервал суммирования( кроме: sam,mad ) должен быть НЕЧЁТНЫМ       &#9553
   &#9553            или округляется вверх к ближайшему нечётному:  N = 2*[N/2]+1       &#9553
   &#9553                                                                               &#9553
   &#9553                </r>!!!  ВНИМАНИЕ  ИСПОЛЬЗУЮТСЯ  ТЕРМИНЫ  !!!<r>                      &#9553
   &#9553                                                                               &#9553
   &#9553 <СКОЛЬЗЯЩАЯ СУММА> = <сумма ПРЕДЫДУЩИХ </r>N/2<r>> + текущий + <сумма СЛЕДУЮЩИХ </r>N/2<r>> &#9553
   &#9553 <СКОЛЬЗЯЩЕЕ СРЕДНЕЕ>  = <СКОЛЬЗЯЩАЯ СУММА> / N                                &#9553
   &#9553                                                                               &#9553
   &#9553 <НАКОПЛЕННАЯ СУММА>   = <сумма ПРЕДЫДУЩИХ </r>N-1<r> > + текущий                     &#9553
   &#9553 <НАКОПЛЕННОЕ СРЕДНЕЕ> = <НАКОПЛЕННАЯ СУММА> / N                               &#9553
   &#9562&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9565
</r>
<b><a name="200">      ms    Stk  [ N=5 ]   >  F</b>  ! "<r>M</r>oving <r>S</r>um"  - СКОЛЬЗЯЩАЯ СУММА   по  N кадрам  СТЭКА.
<b><a name="210">      mm   Stk  [ N=5 ]   >  F</b>  ! "<r>M</r>oving <r>M</r>ean" - СКОЛЬЗЯЩЕЕ СРЕДНЕЕ по  N кадрам  СТЭКА.
________________________________________________________________________________________
<b><a name="220">
      smm   Stk  [ N=5 [ ur=0 ]]   >  F
</b>
"<r>S</r>ubtract <r>M</r>oving <r>M</r>ean" - ВЫЧИТАНИЕ СКОЛЬЗЯЩЕГО СРЕДНЕГО  по N кадрам  СТЭКА.
Параметр: ur задаёт уровень "отсечения"( значения ниже уровня заменяются уровнем ).
________________________________________________________________________________________
<b><a name="230">
      mdis   Stk  [ N=5 [ ur=0 ]]    >  F
</b>
"<r>M</r>oving <r>Dis</r>persion" - СКОЛЬЗЯЩАЯ  ДИСПЕРСИЯ  по N кадрам  СТЭКА  относительно
                      СКОЛЬЗЯЩЕГО СРЕДНЕГО.
Параметр: ur задаёт уровень "отсечения"( значения ниже уровня заменяются уровнем ).
________________________________________________________________________________________
<b><a name="240">
      srm   Stk  [ alf=.1 [ ur=0 ]]  >  F
</b>
"<r>S</r>ubtract <r>R</r>ecurrent <r>M</r>ean" -  ВЫЧИТАНИЕ  РЕКУРЕНТНОГО  СРЕДНЕГО
с параметром альфа[ по умолч. <r>alf</r>=.1 ]  и  уровнем отсечения:

   Sum = x[1]
   for( i=2..N ) {
       result[i] = max( ur, x[i] <r>- Sum</r> );
       Sum = x[i]*<r>alf</r> + Sum*( 1 - <r>alf</r> );
   }
   result[1] = result[2];  // т.к result[1] - неопределён

Параметр: ur задаёт уровень "отсечения"( значения ниже уровня заменяются уровнем ).
________________________________________________________________________________________
<b><a name="250">
      sam   Stk  [ N=5 [ ur=0 ]]  >  F                 !  N может быть чётным
</b>
"<r>S</r>ubtract <r>A</r>cquired <r>M</r>ean" - ВЫЧИТАНИЕ "НАКОПЛЕННОГО" СРЕДНЕГО <r>по N ПРЕДЫДУЩИМ значениям</r>.
Параметр:  ur  задаёт уровень "отсечения"( значения ниже уровня заменяются уровнем ).
________________________________________________________________________________________
<b><a name="260">
      mad   Stk  [ N=5 [ ur=0 ]]  >  F                 !  N может быть чётным
</b>
"<r>M</r>oving <r>A</r>cquired <r>D</r>ispersion" - "НАКОПЛЕННАЯ" ДИСПЕРСИЯ  <r>по  N  ПРЕДЫДУЩИМ значениям</r>.
Параметр:  ur  задаёт уровень "отсечения"( значения ниже уровня заменяются уровнем ).
________________________________________________________________________________________

<b><a name="his">
      hist   Stk   kadr  [ Nint=200]   ! "Histogram" -  Гистограмма значений кадра
</b>
где: Nint - Количество Интервалов в диапазоне [min,max], по умолчанию: 200.
     Не следует делать его слишком большим - увеличивается разброс значений гистограммы
     Допустимый диапазон  Nint:  от  20  до  2000 .

В открытом окне Гистограммы можно изменить Количество Интервалов:
в правом верхнем углу ввести новое значие и <r>нажать <Еnter></r>.

Оценка  НОРМАЛЬНОГО РАСПРЕДЕЛЕНИЯ  ищется так:

  1. Находятся min, max значения в кадре.
  2. Определяется ширина интервала = ( max-min )/Nint .
  3. Все значения кадра сортируются по интервалам.
     Количество значений, попавших в интервал = значению Гистограммы.
  4. Методом наименьших квадратов ищется оценка функции распределения.
     Предполагается, что это нормальное распределение Гаусса.
  5. Отображаются:  Гистограмма, Xo(центр распределения), +/-sigma, 3*sigma .

Рекомендуется  увеличить  ширину  окна Гистограммы  до  ширины  экрана.
Узкие пики  распределения  удобно  рассматривать  с  помощью  <a href="#gra">"Лупы"</a>.
________________________________________________________________________________________
<b><a name="vis">
  команды  ВИЗУАЛИЗАЦИИ  СТОЛБЦОВ / СТРОК  КАДРА :   "<r>VI</r>sualize  <r>C</r>olumn/ <r>L</r>ine  [<r>S</r>pline]" :
                    vic,   vics,   vil,   vils
</b>
Параметры всех четырёх команд  ОДИНАКОВЫ ( в описании использованы jX,j1... - ст. )
<r>','</r> в команде обозначает default = <r>значение по умолчанию</r>.
<r>
vi..  Stk  kadr  jX  j1  j2  ...  [ xy sX sY ]</r> ,   где:
      Stk - имя Стэка
           kadr - номер кадра в Стэке, default=1;
                 jX - ст. X[] - значений,  defaul=0;
                  <r>0</r>     : X[] = 1, 2, 3, 4... - <r>"развёртка по номерам"</r>;
                  N     : X[] = значения N-ст.;
                  (A dA): X[] = A, A+dA, A+2*dA, A+3*dA ...;
                     j1  j2  j3 ... - ст. будут построены, как функции от X[];
                     default jk=1,  если jk<0 - только маркеры без линии;
                                 xy sX sY -экранные координаты левого вернего угла окна;
                                 default: xy 0 0  ( левый верхний угол <r>экрана</r> )/.
Примеры:
  vics q                         !стэк q, 1-кадр,"по номерам", 1-ст.
  vics q,,4                      !---"---"---"---"---"---"---  4-ст.
  vics q 2,5                     !---"--- 2-кадр "---"---"---  5-ст.
  vics q 3 (0 .1) 6 7 xy 400 90  !---"--- 3-кадр,X=0,.1,.2,.3, 6,7-ст. окно: x=400,y=90

default "Легенда" содержит:  цветную линию с маркером  и  номер ст.
<r>"Легенду" можно перетаскивать</r>. Перед сохранением картинки можно добавить тексты и линии.

Используемые  Цвета [ 11 ]:          Маркеры [ 10 ]:
          0 - чёрный             0 - ЛИНИЯ БЕЗ МАРКЕРА
          <font color=ff0000>1 - красный</font>            1 - маленький квадрат
          <font color=0000ff>2 - синий</font>              2 - круг
          <font color=228b22>3 - зелёный</font>            3 - треугольник
          <font color=ff8c00>4 - оранжевый</font>          4 - квадрат
          <font color=d500d5>5 - сиреневый</font>          5 - 5-угольник
          <font color=358b9d>6 - серо-зелёный</font>       6 - ромб
          <font color=00de00>7 - салатовый</font>          7 - +
          <font color=04b4ff>8 - голубой</font>            8 - x
          <font color=a05858>9 - коричневый</font>         9 - Ж
         <font  color=8d8d8d>10 - серый</font>             10 - треугольник перевёрнут.

При больщом количестве графиков цвета повторяются в цикле:  <r>0</r>-10,  маркеры: <r>1</r>-10.
Для задания линии без маркера и/или текста в "Легенде" требуется <r>"ПОДРОБНОЕ ОПИСАНИЕ"</r>:

<r>"j  m  [c  [w  [text]]]"  !кавычки обязательны</r>,  где:
 <r>j</r> - номер ст. если j<0 - только маркеры;
    <r>m</r> - маркер или ',' - default маркер,  m=0 - только линия,  m<0 - только маркеры;
        <r>c</r> - цвет или ',' или 16-ричное значение(6 цифр: RRGGBB, пример: 4B0082 -INDIGO);
            <r>w</r> - "Width"- ширина линии, default=1;
                <r>text</r> - если задан - "Легенда" будет содержать этот текст.
Примеры:
  vics q,,,2 -3 "5 0"   !ct.: 1,2,3,5.  3-только маркеры, 5-только линия.
  vics q,,,2  3 "5 0,3" !w=3
  vics q,,,2 "3 -3 4B0082 2 Задерка" -7 "8 6 2 2" "15 -10,3 dt"
       q кадр-1, "по номерам" следующие ст.:
          1 ст. чёрный, малый квадрат;
            2 ст. красный, круг;
              3 ст. треугольник, INDIGO, без линии, w=2, текст="Задержка";
                7 ст. зелёный, квадрат, без линии;
                  8 ст. синий, ромб, w=2;
                    15 ст. треуг.перевёрнутый, сиреневый, без линии, w=3,"dt".

<a name="gra">  <b>РАБОТА  С  ГРАФИЧЕСКИМИ  ОКНАМИ :</b>

  &lt;F1>                  - краткая справка.
  <Сtrl+S>              - сохранение изображения в .WMF-формате
  <Сtrl + >/<Сtrl - >   - быстрое увеличение / уменьшение окна на 10 %.
                          Размеры окна можно менять стандартными средствами Windows.

Предметные координаты(ПК) курсора отображаются в заголовке окна.
<r>При КЛИКЕ любой клавишей мыши ПК копируются в БУФЕР ОБМЕНА.</r>
Это позволяет строить таблицу измерений:  после клика перейти в редактор текста
и вставить("Paste") значение из буфера обмена( <Сtrl+V> или < Shift+Ins> ).

Можно выделить и увеличить фрагмент графика - <r>"ЛУПА"</r>:
1. Нажать кн.Мыши и сдвинуть ("Drag & Drop" - нажать и перетащить ) <r>ВНИЗ ВПРАВО</r>.
2. Выбрать размер выделенного прямоугольника.
3. Отпустить кн.Мыши и кликнуть в прямоугольник - появится новое окно "ЛУПА".
4. Выбрать размер окна ЛУПЫ.
5. Выбрать положение ЛУПЫ в основном окне: "Drag & Drop" прямоугольника.
6. Размер прямоугольника можно менять:"Drag & Drop" <r>правого нижнего угла</r> прямоугольника.
7. Прямоугольник в основном окне существует до тех пор, пока не закрыто окно ЛУПЫ.

В любой точке окна можно добавить <r>ТЕКСТ</r> и/или <r>ЛИНИЮ</r> :

  - <r>&lt;Ctrl+T></r> - добавить ТЕКСТ;
  - в появившемсе диалоге выбрать Цвет, Размер, ввести текст ;
  - перетащить текст в нужное место, нажать кн.OK или &lt;Enter> ;

  - <r>&lt;Ctrl+L></r> - добавить ЛИНИЮ ;
  - перетаскивыя активные точки кривой Безье, получить нужную линию ;
  - <r>&lt;X></r>      - превратить кривую Безье в прямую и обратно ;
  - <r>&lt;A>/&lt;D></r>  -"Add"/"Delete" - добавить/ убрать дополнительный фрагмент линии;
  - <r>&lt;+>/&lt;-></r>  - увеличить/ уменьшить толщину линии ;

  - <r>&lt;Сtrl+Z></r> - убрать текст/линию в случае ошибки ;
               несколько нажатий убирают предыдущие тексты/линии .

               <r>НАСТРОЙКА  ОТСТУПОВ</r>  графики  от  границ  Окна :
  - <r>&lt;Ctrl></r> + навести курсор на границу Окна. Форма курсора должна измениться на стрелку.
    При  нажатых  <r>&lt;Ctrl>  и  &lt;Левой Кн.Мыши></r>  перетащить  границу Окна  в  новое  место.
    В  освободившееся  пространство  можно  добавить  линии  и  текст.
    Отступы  не  изменяются  при  изменении  размера  Окна.   Если  при  изменении
    размера Окна  действует  режим  Настройки Отступов - нажать  <r>&lt;Ctrl></r>  для выключения.

Изображение основного окна и "ЛУПЫ" можно сохранить в .WMF-формате.
"Windows Meta File" - векторный Формат графики, который хорошо масштабируется.
Поддерживается  MS Word, ACDSee ...

Для сохранения кликнуть выбранное окно и нажать <r><Сtrl+S></r>.
В появившемся окне выбора файлов ввести имя файла.
<b>
    ОСОБЕННОСТИ  ГРАФИКИ :
</b>
- Размер шрифта в окне фиксирован( не увеличивается при увеличении размеров окна ).
  Если в документе нужны крупные подписи осей - выберите окно малого размера.

- При изменении размеров окна неизменным остаётся позиция левого нижнего угла текста ;
  "Легенда", в отличии от текста, фиксируется правым верхним углом !!!

- Соотношение размеров сторон WMF-образа можно менять только до момента сохранения ^S.

- WMF - векторный формат( ЛИНИИ, НЕТ пикселей ), поэтому он хорошо масштабируется.
  В документе растяните изображение до нужного размера.

- При манипулировании WMF-образом шрифт будет изменять размер в соответствии с размером
  образа. В WMF-образе отношение высоты образа к размеру шрифта фиксировано.
________________________________________________________________________________________
<b><a name="tif">
    команда:   tif   File.tif    [Npro=99999]   -  Показать  tif-файл
                       tif   Config   [Npro=99999]   -  Показать  несколько  tif-файлов
</b>
Если файл многостраничный, то последовательно отображаются все страницы.
Цикл повторяется Npro раз. Этот параметр не следует указывать, если не требуется
фиксированное количество просмотров.

Для синхронного показа нескольких tif-файлов требуется <r>файл конфигурации:

    &#9556&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9559
    &#9553 dt[ms] = <интервал между кадрами> &#9553
    &#9553                                   &#9553
    &#9553 File1.tif,  x1, y1,  w1, h1       &#9553
    &#9553 File2.tif,  x2, y2,  w2, h2       &#9553
    &#9553       ...                         &#9553
    &#9553 FileN.tif,  xN, yN,  wN, hN       &#9553
    &#9562&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9552&#9565
</r>
где:  xN, yN  - координаты левого верхнего угла N изображения,
      wN, hN  - ширина, высота N изображения.

Просмотр можно:
  - остановить/продолжить:  <r>ПРАВЫЙ КЛИК мыши или <пробел></r>;
  - ускорить / замедлить:   <r><Сtrl+Right>/ <Сtrl+Left></r>,  по умолчанию 5 кадров/сек.

Кадры можно листать вращением колеса мыши или клавишами: <r><Нome>/ <Еnd>,  &lt;Left>/ &lt;Right></r>
________________________________________________________________________________________
<b><a name="jj">
    команда:   jj - "Java.java"  - исполнить  File.java  в  исходном  коде
</b>
Требуется установленный JDK см. <a href="#ins">Установка</a>.
Простейший способ использования - генерация данных в формате ### :
В стандартный поток ввода/вывода(<r> Std.</r>) выводятся заголовок и данные.

Пример 1: <r>"минор МАЖОР"</r>( в папке: pik3d\exe, файл: MinMaj.java ):
Сложение трёх гармоник с частотами:  1, <r>6/5</r>, 3/2 - минор: тоника, малая   терция, квинта
                                     1, <r>5/4</r>, 3/2 - МАЖОР: тоника, большая терция, квинта<f>
package usr;
public class MinMaj {
  static public void main( String[] a ) {
    System.out.println("### minMAJ [ 200, 3 ]");                 // ### Header
    for(int i=0; i<200; i++) {
       var t = i*( 2*Math.PI/10 );                               // 10 points/period
       var k = Math.sin( t ) + Math.sin( t*3/2 );                // tonika + kvinta
       System.out.println( i/10.+"\t"+( k + Math.sin( t*6/5 ))   // minor
                                +"\t"+( k + Math.sin( t*5/4 ))); // MAJOR
    }
  }
}
//> jj MinMaj.java
//> jj MinMaj.java| vic #,1 2 3
//> jj MinMaj.java| vics #,1 "2 0 2 3 minor" "3 0,3 MAJOR"
</f>
Три последние строки - способы запуска('>'- приглашение консоли ).
Рекомендуется:
  - растянуть граф.окно в ширину экрана;
  - перетащить "Легенду" в удобное место;
  - добавить текст: ^T, изменить размер и цвет, перетащить в нужное место;
  - добавить линии: ^L, изменить цвет и толщину, +/-/X;
  - попробовать удалять добавленные тексты и линии: ^Z;
  - ^S - сохранить окно в .WMF-файле: с последующей вставкой в Word документ;
  - попробовать работать с Лупой: тащить вниз и вправо при нажатой кнопке мыши;
  - перетаскивать прямоугольник Лупы.

Кстати, обратите внимание на сбой частоты для минора( 4-6, 14-16 периоды ).
По этой причине минор звучит грустно.

Более продвинутый способ использования <r>команды: jj</r> - обработка ### файлов.
Для этого класс должен наследовать библиотеку ввода.вывода <r>pik.io</r>.

Пример 2: <r>"Реверс кадров в Стэке"</r>( pik3d\exe\Reverse.java ):
<f>
package usr;
import java.util.ArrayList;
import pik.io;

public class Reverse extends io {
  public static void main( String[] a ) throws Exception {
    var ff = new ArrayList<float[][]>();

    io rr = new io(a[0]);
    float[][] v;
    while( (  v=rr.inBlock()) !=null ) ff.add( v );  // input & save Kadr
    rr.close();

    int i=ff.size();
    while(--i >=0 ) ttBlock( ff.get( i ), 4 );       // out Kadr in Reverse
    clott();
  }
}
//> jj  Reverse.java  Stk > RevStk
//> jj  Reverse.java  Stk | s3d #
</f>
<a name="pik"><b>        Наиболее  употребительные  методы  pik.io :

Вывод  в  стандартный поток Std.</b>( cтатические методы ):
  void tt( String s ) // вывод строки в Std.;
  void <r>ee</r>( String s ) // вывод строки в поток: <r>System.err</r>;
                      // при выводе кадра нужно указать fmt, см. <a href="#dat">Формат данных</a>
                      // 0-Text, 2-I2, 4-F4, 8-D8. Порядок байтов: <r>BE ="Big-Endian"</r>.
  void ttBlock( float [][] ff, int fmt ) // вывод кадра <r>float [][]</r> в Std.
  void ttBlock( double[][] dd, int fmt ) // вывод кадра <r>double[][]</r> в Std.

  void ttBlockName( float [][] ff, String kName, int fmt, boolean bigEnd ) //вывод кадра
  void ttBlockName( double[][] dd, String kName, int fmt, boolean bigEnd ) //с заданным
                 // именем и порядком байтов, bigEnd=true - BE | =false -"Little-Endian"
  void clott()   // закрыть Std., должен ВСЕГДА вызываться в конце программы с <r>pik.io</r>.

<b>Чтение Кадра:</b>
  io reader = new io( String fileName ) // создать reader Стэка( конструктор ),
                    // если  fileName ="#", то чтение осуществляется из Std.
  float [][] reader.inBlock () // считать кадр в <r>float [][]</r> - массив;
  double[][] reader.inBlock8() // считать кадр в <r>double[][]</r> - массив;
                               // Кадр может быть в любом формате( Text,I2,F4,D8 ).
                               // Результат =null -означает: в Стэке НЕТ больше кадров.
  void reader.close()          // Закрытие и освобождение ресурсов reader.
________________________________________________________________________________________
<b><a name="jc">
      ССОЗДАНИЕ   НОВОЙ   КОМАНДЫ ,   ПОДГОТОВКА  ЛОНЧЕРА :
</b>
В описании  в качестве имени java-файла и команды  используются:  <r>Fun.java и Fun</r>.

1. Отладить  <r>Fun.java</r>  и  функциональность  с помощью ><a href="#jj"> jj Fun.java</a>.
   Если требуются  дополнительные  библиотеки, их нужно добавить  в  переменную среды:
   <r>PIK3D_JAVA</r>, <a href="#ins">см. УСТАНОВКА</a> (в конец переменой, разделитель ';').

2. СКОМПИЛИРОВАТЬ: > <b>jc   Fun.java</b> .  В случае успеха должен появиться  <r>Fun.class</r> .

3. Скопировать  <r>Fun.java  и  Fun.class</r>  в библиотеку:  <r>pik3d\lib\usr.jar\<b>usr</b></r> .
   Файлы.jar являются ZIP-архивами, поэтому для копирования подойдёт любая  ZIP-утилита.
   <r>! Копировать  в папку: <b>usr</b>  архива: usr.jar !</r>

4. Скопировать ЛОНЧЕР:  <r>pik3d\exe\add.exe  -->  pik3d\exe\Fun.exe</r> .

5. В <r>БИНАРНОМ РЕДАКТОРЕ</r>( например: Notepad++) исправить код  <r>Fun.exe</r> :
   найти:  <r>cmd.add</r>  и заменить на  <r>usr.Fun</r> .
   <r>!!! Размер ЛОНЧЕРА: 17408 байт !!!</r>  Если размер отличается, то нужно добавить/удалить
   требуемое число пробелов  после исправленного текста.  Сохранить  <r>Fun.exe</r> .
________________________________________________________________________________________
<f>
                          автор:  К.А.Ильяшенко, e-mail: kilyashenko.pik3d@gmail.com
                          Сообщения об ошибках, замечания, пожелания  приветствуются</f>
</pre></h5></body></html>
